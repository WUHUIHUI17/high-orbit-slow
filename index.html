<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>卫星轨道运动演示 - 专业版</title>
    <style>
        /* --- 基础布局 --- */
        body {
            margin: 0;
            background-color: #000; /* 纯黑背景，更像太空 */
            color: #ccc;
            font-family: 'Segoe UI', 'Roboto', sans-serif;
            overflow: hidden; /* 禁止浏览器默认滚动，完全由Canvas接管 */
            user-select: none; /* 防止拖拽时选中文字 */
        }

        /* 画布全屏 */
        canvas {
            display: block;
            width: 100vw;
            height: 100vh;
            cursor: grab; /* 提示可拖拽 */
        }
        canvas:active {
            cursor: grabbing;
        }

        /* --- 左侧轨道控制器 --- */
        #left-panel {
            position: absolute;
            top: 20px;
            left: 20px;
            width: 200px;
            background: rgba(20, 20, 20, 0.85);
            backdrop-filter: blur(5px);
            padding: 15px;
            border-radius: 8px;
            border-left: 3px solid #61dafb;
            box-shadow: 0 0 15px rgba(0,0,0,0.5);
        }

        #left-panel h2 {
            margin: 0 0 15px 0;
            font-size: 16px;
            color: #fff;
            border-bottom: 1px solid #444;
            padding-bottom: 8px;
        }

        .orbit-option {
            display: block;
            margin-bottom: 12px;
            cursor: pointer;
            font-size: 14px;
            color: #aaa;
            transition: color 0.2s;
        }
        .orbit-option:hover { color: #fff; }
        .orbit-option input { margin-right: 10px; cursor: pointer; }

        /* --- 右上角遥感数据面板 --- */
        #data-panel {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 260px;
            background: rgba(20, 20, 20, 0.9);
            border: 1px solid #333;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Consolas', monospace;
            display: none; /* 默认隐藏 */
            pointer-events: none; /* 让鼠标事件穿透，不影响拖拽 */
        }

        .data-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            border-bottom: 1px solid #333;
            padding-bottom: 5px;
            font-size: 13px;
        }
        .data-val { color: #fff; font-weight: bold; }

        /* --- 底部播放控制 --- */
        #bottom-controls {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 15px;
            background: rgba(30, 30, 30, 0.8);
            padding: 10px 20px;
            border-radius: 30px;
            align-items: center;
        }

        button {
            background: #2196F3;
            color: white;
            border: none;
            padding: 6px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 13px;
        }
        button:hover { background: #42A5F5; }
        button.reset { background: #FF5252; }
        
        /* 缩放提示 */
        #zoom-hint {
            position: absolute;
            bottom: 10px;
            right: 10px;
            color: #555;
            font-size: 12px;
        }
    </style>
</head>
<body>

<canvas id="spaceCanvas"></canvas>

<div id="left-panel">
    <h2>轨道控制中心</h2>
    <label class="orbit-option" style="color: #FF5252;">
        <input type="checkbox" id="cb-low"> 近地轨道 (LEO)
    </label>
    <label class="orbit-option" style="color: #FFD740;">
        <input type="checkbox" id="cb-mid"> 中圆轨道 (MEO)
    </label>
    <label class="orbit-option" style="color: #69F0AE;">
        <input type="checkbox" id="cb-high"> 同步轨道 (GEO)
    </label>
</div>

<div id="data-panel">
    <div style="color:#888; border-bottom:1px solid #555; margin-bottom:10px; padding-bottom:5px;">实时遥测 (Telemetry)</div>
    <div id="stats-content"></div>
</div>

<div id="bottom-controls">
    <button id="btn-toggle">暂停 / 播放</button>
    <button id="btn-reset" class="reset">重置位置</button>
    <div style="display:flex; align-items:center; gap:5px; margin-left:10px;">
        <span style="font-size:12px;">演化速率:</span>
        <input type="range" id="time-scale" min="0.1" max="3" step="0.1" value="1" style="width:80px;">
    </div>
</div>

<div id="zoom-hint">鼠标滚轮缩放 / 左键拖拽移动</div>

<script>
    const EARTH_IMAGE_SRC = 'earth.jpg'; // 请确保文件名一致

    const canvas = document.getElementById('spaceCanvas');
    const ctx = canvas.getContext('2d');
    const statsDiv = document.getElementById('stats-content');
    const dataPanel = document.getElementById('data-panel');

    // --- 视图与相机状态 (实现缩放/移动核心) ---
    let camera = {
        x: 0,
        y: 0,
        zoom: 1,
        minZoom: 0.2,
        maxZoom: 5
    };
    let isDragging = false;
    let lastMouseX = 0;
    let lastMouseY = 0;

    // --- 物理模型参数 ---
    // 为了视觉效果，轨道半径是虚拟像素值，但显示速度我们使用真实物理常数
    const satData = [
        { 
            id: 'leo', name: 'LEO (近地)', 
            r: 140, // 视觉半径 (像素)
            realV: 7.8, // 真实物理速度 (km/s) 用于显示
            color: '#FF5252', 
            angle: 0, laps: 0, visible: false 
        },
        { 
            id: 'meo', name: 'MEO (中轨)', 
            r: 260, 
            realV: 3.9, // GPS卫星大约速度
            color: '#FFD740', 
            angle: 0, laps: 0, visible: false 
        },
        { 
            id: 'geo', name: 'GEO (同步)', 
            r: 420, 
            realV: 3.07, // 同步卫星标准速度
            color: '#69F0AE', 
            angle: 0, laps: 0, visible: false 
        }
    ];

    // 视觉模拟参数
    // 根据开普勒第三定律 T^2 ~ r^3，即 v ~ 1/sqrt(r)
    // 我们用 GEO 作为基准来计算另外两个的视觉角速度，保证动画逻辑正确
    const visualGM = 80000; // 动画引力常数
    satData.forEach(sat => {
        sat.visualV = Math.sqrt(visualGM / sat.r); // 动画用的像素速度
        sat.omega = sat.visualV / sat.r;           // 角速度
        // 周期计算用于逻辑 (帧数)
        sat.period = (2 * Math.PI * sat.r) / sat.visualV;
    });

    let isPaused = false;
    let timeSpeed = 1;
    let earthImg = new Image();
    let imgLoaded = false;

    // --- 初始化 ---
    function init() {
        resize();
        window.addEventListener('resize', resize);
        
        earthImg.src = EARTH_IMAGE_SRC;
        earthImg.onload = () => { imgLoaded = true; };
        
        setupControls();
        setupInteraction(); // 绑定鼠标滚轮和拖拽
        
        requestAnimationFrame(loop);
    }

    function resize() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
    }

    // --- 交互逻辑 (拖拽与缩放) ---
    function setupInteraction() {
        // 滚轮缩放
        canvas.addEventListener('wheel', (e) => {
            e.preventDefault();
            const zoomSensitivity = 0.001;
            const delta = -e.deltaY * zoomSensitivity;
            const newZoom = camera.zoom + delta;
            
            // 限制缩放范围
            if (newZoom >= camera.minZoom && newZoom <= camera.maxZoom) {
                camera.zoom = newZoom;
            }
        }, { passive: false });

        // 鼠标按下开始拖拽
        canvas.addEventListener('mousedown', (e) => {
            isDragging = true;
            lastMouseX = e.clientX;
            lastMouseY = e.clientY;
            canvas.style.cursor = 'grabbing';
        });

        // 鼠标移动
        window.addEventListener('mousemove', (e) => {
            if (!isDragging) return;
            const dx = e.clientX - lastMouseX;
            const dy = e.clientY - lastMouseY;
            
            camera.x += dx;
            camera.y += dy;
            
            lastMouseX = e.clientX;
            lastMouseY = e.clientY;
        });

        // 鼠标松开
        window.addEventListener('mouseup', () => {
            isDragging = false;
            canvas.style.cursor = 'grab';
        });
    }

    function setupControls() {
        document.getElementById('cb-low').onchange = (e) => satData[0].visible = e.target.checked;
        document.getElementById('cb-mid').onchange = (e) => satData[1].visible = e.target.checked;
        document.getElementById('cb-high').onchange = (e) => satData[2].visible = e.target.checked;

        const btnToggle = document.getElementById('btn-toggle');
        btnToggle.onclick = () => {
            isPaused = !isPaused;
            btnToggle.innerText = isPaused ? "▶ 继续" : "⏸ 暂停";
            btnToggle.style.backgroundColor = isPaused ? "#4CAF50" : "#2196F3";
        };

        document.getElementById('btn-reset').onclick = () => {
            satData.forEach(s => { s.angle = 0; s.laps = 0; });
            // 重置视角
            camera.x = 0;
            camera.y = 0;
            camera.zoom = 1;
        };

        document.getElementById('time-scale').oninput = (e) => {
            timeSpeed = parseFloat(e.target.value);
        };
    }

    // --- 绘图循环 ---
    function loop() {
        // 1. 清空背景
        ctx.fillStyle = '#000';
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // 2. 应用相机变换 (平移 + 缩放)
        ctx.save();
        // 将原点移到屏幕中心 + 相机偏移
        ctx.translate(canvas.width / 2 + camera.x, canvas.height / 2 + camera.y);
        ctx.scale(camera.zoom, camera.zoom);

        // 3. 绘制内容
        drawScene();

        ctx.restore();

        // 4. 更新UI (不需要随相机缩放)
        updateUI();

        requestAnimationFrame(loop);
    }

    function drawScene() {
        // 绘制地球
        const earthR = 100;
        if (imgLoaded) {
            ctx.save();
            ctx.beginPath();
            ctx.arc(0, 0, earthR, 0, Math.PI * 2);
            ctx.clip();
            ctx.drawImage(earthImg, -earthR, -earthR, earthR * 2, earthR * 2);
            ctx.restore();
            
        } else {
            // 备用地球
            ctx.beginPath();
            ctx.arc(0, 0, earthR, 0, Math.PI * 2);
            ctx.fillStyle = '#0D47A1';
            ctx.fill();
            ctx.fillStyle = '#fff';
            ctx.font = '10px Arial';
            ctx.textAlign = 'center';
            ctx.fillText("EARTH", 0, 4);
        }

        // 绘制卫星
        satData.forEach(sat => {
            if (!sat.visible) return;

            // 物理更新
            if (!isPaused) {
                const oldAngle = sat.angle;
                sat.angle += sat.omega * timeSpeed * 0.5;
                if (Math.floor(sat.angle / (Math.PI * 2)) > Math.floor(oldAngle / (Math.PI * 2))) {
                    sat.laps++;
                }
            }

            // 坐标计算 (相对于中心 0,0)
            const x = Math.cos(sat.angle) * sat.r;
            const y = Math.sin(sat.angle) * sat.r;

            // 轨道线
            ctx.beginPath();
            ctx.strokeStyle = sat.color + 'CC';
            ctx.lineWidth = 3 / camera.zoom; // 线宽保持视觉一致，不随缩放变太粗
            if (ctx.lineWidth < 0.5) ctx.lineWidth = 0.5;
            ctx.arc(0, 0, sat.r, 0, Math.PI * 2); 
            ctx.stroke();

            // 卫星点
            ctx.beginPath();
            ctx.fillStyle = sat.color;
            ctx.arc(x, y, 6 / camera.zoom, 0, Math.PI * 2); // 卫星大小随缩放微调
            ctx.fill();

            // 速度矢量 (长度固定，不随缩放变得过大)
            // 矢量方向
            const vx = -Math.sin(sat.angle);
            const vy = Math.cos(sat.angle);
            const vectorLen = 40 * (sat.visualV / satData[2].visualV) / camera.zoom; // 长度随速度比例，反向缩放保持视觉长度
            
            drawArrow(ctx, x, y, x + vx * vectorLen, y + vy * vectorLen, sat.color);
        });
    }

    function drawArrow(ctx, x1, y1, x2, y2, color) {
        const head = 8 / camera.zoom;
        const dx = x2 - x1;
        const dy = y2 - y1;
        const angle = Math.atan2(dy, dx);
        
        ctx.beginPath();
        ctx.strokeStyle = color;
        ctx.fillStyle = color;
        ctx.lineWidth = 2 / camera.zoom;
        ctx.moveTo(x1, y1);
        ctx.lineTo(x2, y2);
        ctx.stroke();
        
        ctx.beginPath();
        ctx.moveTo(x2, y2);
        ctx.lineTo(x2 - head * Math.cos(angle - Math.PI / 6), y2 - head * Math.sin(angle - Math.PI / 6));
        ctx.lineTo(x2 - head * Math.cos(angle + Math.PI / 6), y2 - head * Math.sin(angle + Math.PI / 6));
        ctx.fill();
    }

    function updateUI() {
        let html = '';
        let hasVisible = false;

        satData.forEach(sat => {
            if (sat.visible) {
                hasVisible = true;
                html += `
                    <div class="data-row" style="border-left: 3px solid ${sat.color}; padding-left: 8px;">
                        <div>${sat.name}</div>
                        <div style="text-align:right">
                            <div class="data-val">${sat.realV} km/s</div>
                            <div style="color:#888; font-size:11px;">圈数: ${sat.laps}</div>
                        </div>
                    </div>
                `;
            }
        });

        if (hasVisible) {
            statsDiv.innerHTML = html;
            dataPanel.style.display = 'block';
        } else {
            dataPanel.style.display = 'none';
        }
    }

    init();

</script>
</body>
</html>

